# AI Development Rules - Flipgame Project

## ü§ñ Istruzioni per AI Assistant

Questo file contiene regole OBBLIGATORIE per lo sviluppo del progetto Flipgame. Tutti gli AI assistant devono seguire queste regole per mantenere la coerenza e qualit√† del codice.

---

## ‚ö†Ô∏è REGOLE FONDAMENTALI

### 1. **ZERO DUPLICAZIONE - PRINCIPIO DRY**
- ‚ùå **MAI duplicare** messaggi, validazioni, template HTML o logica
- ‚úÖ **SEMPRE usare** le utility classes esistenti
- ‚úÖ **SEMPRE verificare** se esiste gi√† una funzione simile prima di crearne una nuova

### 2. **CONSTANTS FIRST**
- ‚ùå **MAI hardcodare** testi, messaggi o configurazioni
- ‚úÖ **SEMPRE aggiungere** nuovi messaggi in `CONSTANTS.MESSAGES`
- ‚úÖ **SEMPRE usare** `Utils.formatMessage()` per messaggi con placeholder

### 3. **ARCHITECTURAL COMPLIANCE**
- ‚úÖ **SEMPRE rispettare** l'ordine: `CONSTANTS ‚Üí Utils ‚Üí HtmlBuilder ‚Üí DisplayManager ‚Üí App`
- ‚úÖ **SEMPRE usare** le classi helper appropriate per ogni operazione

### 4. **MOBILE-FIRST DESIGN**
- ‚úÖ **SEMPRE ottimizzare** per touch interactions
- ‚úÖ **SEMPRE considerare** performance su dispositivi mobili
- ‚úÖ **SEMPRE testare** gesture handling

### 5. **TESTING REQUIREMENTS**
- ‚úÖ **SEMPRE testare** modifiche su localhost:8099 prima di completare
- ‚úÖ **SEMPRE verificare** che il gioco sia raggiungibile prima di procedere
- ‚ùå **MAI completare** modifiche senza test funzionale
- üîÑ **RICHIEDERE** all'utente di avviare il server se localhost:8099 non √® raggiungibile

---

## üèóÔ∏è ARCHITETTURA OBBLIGATORIA

### **Hierarchy di Responsabilit√†:**
```
üèõÔ∏è CONSTANTS          ‚Üí Configurazioni centrali
üîß Utils               ‚Üí Funzioni di utilit√† generiche  
üèóÔ∏è HtmlBuilder         ‚Üí Generazione HTML standardizzata
üìä DisplayManager      ‚Üí Pattern di visualizzazione
üéÆ GameManager         ‚Üí Logica di gioco principale
üéØ App                 ‚Üí Controller principale
```

---

## üìã REGOLE SPECIFICHE PER COMPONENTI

### **CONSTANTS**
```javascript
// ‚úÖ OBBLIGATORIO: Tutti i testi in CONSTANTS
CONSTANTS.MESSAGES.NEW_MESSAGE = 'Messaggio con {placeholder}';
CONSTANTS.GAME_CONFIG.NEW_FEATURE = 'value';
CONSTANTS.RENDER_SIZE_CONFIG.NEW_RATIO = 0.5;

// ‚ùå VIETATO: Testi hardcoded
const message = 'Errore durante il salvataggio';
```

### **Utils**
```javascript
// ‚úÖ OBBLIGATORIO: Usare Utils per validazioni
try {
    Utils.validateLevelData(levelData);
} catch (error) {
    console.error(error.message);
    return;
}

// ‚ùå VIETATO: Duplicare logica di validazione
if (!levelData) {
    console.error('Level data required');
    return;
}
```

### **Modals**
```javascript
// ‚úÖ OBBLIGATORIO: Usare Utils.showModal / Utils.hideModal
Utils.showModal('settingsModal');
Utils.hideModal('settingsModal');

// ‚ùå VIETATO: Setup manuale modali con stringhe duplicate
const modal = new bootstrap.Modal(document.getElementById('settingsModal'));
modal.show();
```

### **HtmlBuilder**
```javascript
// ‚úÖ OBBLIGATORIO: Usare HtmlBuilder per elementi comuni
HtmlBuilder.createButton('Pausa', 'btn-primary', onclick, 'bi-pause');
HtmlBuilder.createCanvas('gameCanvas', 'game-canvas');
HtmlBuilder.createTouchArea('touchArea', 'touch-area');

// ‚ùå VIETATO: Template HTML inline
const html = `<button class="btn btn-primary">Pausa</button>`;
```

### **DisplayManager**
```javascript
// ‚úÖ OBBLIGATORIO: Usare DisplayManager per stati vuoti e liste
if (!DisplayManager.renderGameState(container, gameState)) {
    DisplayManager.renderEmptyState(container, 'Stato gioco non disponibile');
}

// ‚ùå VIETATO: Gestione manuale stati vuoti
if (!gameState) {
    container.innerHTML = '<div>Nessun stato</div>';
}
```

### **GameManager**
```javascript
// ‚úÖ OBBLIGATORIO: Usare GameManager per logica di gioco
GameManager.loadLevel(levelNumber);
GameManager.handleTouch(x, y);
GameManager.checkWinCondition();

// ‚ùå VIETATO: Logica di gioco sparsa nel codice
if (circle.x === end.x && circle.y === end.y) {
    // win logic here
}
```

---

## üé® REGOLE CSS

### **Classi Base Obbligatorie:**
```css
/* ‚úÖ USARE queste classi base */
.game-canvas         /* Per il canvas principale */
.touch-area          /* Per aree touch interattive */
.game-ui             /* Per elementi UI del gioco */
.mobile-optimized    /* Per ottimizzazioni mobile */
```

### **Pattern CSS Obbligatori:**
- ‚úÖ **Touch targets**: Minimo 44px per elementi interattivi
- ‚úÖ **Responsive design**: Usare viewport units
- ‚úÖ **Performance**: Evitare animazioni costose
- ‚ùå **Colori hardcoded**: Usare CSS variables

---

## üéÆ REGOLE SPECIFICHE GIOCO

### **Canvas Management**
```javascript
// ‚úÖ OBBLIGATORIO: Usare pattern standard per canvas + devicePixelRatio
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

function resizeCanvas() {
  const dpr = window.devicePixelRatio || 1;
  canvas.style.width = window.innerWidth + 'px';
  canvas.style.height = window.innerHeight + 'px';
  canvas.width = Math.floor(window.innerWidth * dpr);
  canvas.height = Math.floor(window.innerHeight * dpr);
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}

ctx.clearRect(0, 0, canvas.width, canvas.height);
```

### **Touch Event Handling**
```javascript
// ‚úÖ OBBLIGATORIO: Gestire touch events correttamente (e.g., stopPropagation)
canvas.addEventListener('touchstart', (e) => { e.preventDefault(); e.stopPropagation(); handleTouchStart(e); }, { passive: false });
canvas.addEventListener('touchmove', (e) => { e.preventDefault(); e.stopPropagation(); handleTouchMove(e); }, { passive: false });
canvas.addEventListener('touchend', (e) => { e.preventDefault(); e.stopPropagation(); handleTouchEnd(e); }, { passive: false });
```

### **Level Management**
```javascript
// ‚úÖ OBBLIGATORIO: Usare pattern standard per livelli
GameManager.loadLevel(levelNumber);
GameManager.saveProgress();
GameManager.checkLevelCompletion();
```

---

## üîß WORKFLOW OBBLIGATORIO

### **Per NUOVE FUNZIONALIT√Ä:**

#### 1. **Verifica Esistente**
```
PRIMA di creare qualsiasi cosa, verificare se esiste gi√†:
- Messaggio simile in CONSTANTS
- Funzione simile in Utils/HtmlBuilder/DisplayManager/GameManager
- Pattern simile nel codice esistente
```

#### 2. **Aggiunta Nuovo Game Feature**
```javascript
// STEP 1: Aggiorna CONSTANTS
CONSTANTS.GAME_CONFIG.NEW_FEATURE = {
    enabled: true,
    settings: {...}
};

// STEP 2: Estendi GameManager se necessario
static handleNewFeature(data) {
    // Logica specifica
}

// STEP 3: Implementa nella classe principale
handleNewGameAction() {
    GameManager.handleNewFeature(data);
}
```

#### 3. **Nuovi Componenti HTML**
```javascript
// SEMPRE aggiungere in HtmlBuilder
static createNewGameComponent(data, options = {}) {
    return `<div class="game-component">${data}</div>`;
}
```

### **Per MODIFICHE ESISTENTI:**

#### 1. **Controllo Impact**
```
- Verificare se la modifica impatta altri componenti
- Controllare se esistono utility functions da aggiornare
- Verificare la coerenza con pattern esistenti
- Testare su dispositivi mobili
```

#### 2. **Testing Obbligatorio**
```
- Testare TUTTE le funzionalit√† di gioco
- Verificare touch interactions
- Controllare performance su mobile
- Testare diversi livelli
```

---

## üö® ERRORI COMUNI DA EVITARE

### **‚ùå ERRORE**: Duplicare game logic
```javascript
// NON fare questo
if (circle.x === end.x && circle.y === end.y) { /* win logic */ }
if (circle.x === end.x && circle.y === end.y) { /* win logic */ }
```
### **‚úÖ CORRETTO**: Usare GameManager
```javascript
GameManager.checkWinCondition();
```

### **‚ùå ERRORE**: Hardcodare configurazioni
```javascript
const canvasWidth = 800;
const canvasHeight = 600;
```
### **‚úÖ CORRETTO**: Usare CONSTANTS
```javascript
const ballRadius = CONSTANTS.RENDER_SIZE_CONFIG.BALL_RADIUS_RATIO;
const gridSize = CONSTANTS.RENDER_SIZE_CONFIG.GRID_DOT_RATIO;
```

### **‚ùå ERRORE**: Setup manuale touch events
```javascript
canvas.onmousedown = function(e) { /* mouse logic */ };
```
### **‚úÖ CORRETTO**: Usare pattern standard
```javascript
canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
```

---

## üìä CHECKLIST OBBLIGATORIA PRE-COMMIT

Prima di ogni commit, verificare:

- [ ] **Zero duplicazioni**: Nessun codice/messaggio duplicato
- [ ] **CONSTANTS usage**: Tutti i testi sono in CONSTANTS
- [ ] **Utils usage**: Validazioni usano Utils
- [ ] **Modals**: Usa Utils.showModal()/Utils.hideModal()
- [ ] **HtmlBuilder usage**: Elementi comuni usano HtmlBuilder
- [ ] **DisplayManager usage**: Stati vuoti usano DisplayManager
- [ ] **GameManager usage**: Logica di gioco usa GameManager
- [ ] **CSS compliance**: Classi base utilizzate correttamente
- [ ] **Mobile optimization**: Touch targets e performance
- [ ] **Canvas performance**: Rendering ottimizzato
- [ ] **Function naming**: Naming consistente con esistente
- [ ] **Error handling**: Gestione errori uniforme
- [ ] **Documentation**: Commenti aggiornati se necessario

---

## üéØ STANDARD DI QUALIT√Ä

### **Target Obbligatori:**
- **Duplicazione codice**: 0%
- **Messaggi hardcoded**: 0%
- **Consistenza pattern**: 100%
- **Copertura utility functions**: 100%
- **Mobile performance**: 60fps su dispositivi target

### **Obiettivi Architetturali:**
- Modifiche centralizzate in punti specifici
- Pattern riutilizzabili per operazioni comuni
- Consistenza garantita dall'architettura
- Scalabilit√† per nuove funzionalit√† di gioco
- Performance ottimizzata per mobile

---

## üîç DEBUGGING GUIDE

### **Se qualcosa non funziona:**

1. **Verifica order di caricamento**: CONSTANTS ‚Üí Utils ‚Üí HtmlBuilder ‚Üí etc.
2. **Controlla console errors**: Errori JavaScript bloccanti
3. **Verifica CONSTANTS**: Tutti i riferimenti esistono
4. **Testa utility functions**: Utils, HtmlBuilder funzionano
5. **Valida CSS**: Classi base applicate correttamente
6. **Testa touch events**: Gestione touch funziona
7. **Verifica canvas**: Rendering corretto

### **Common Issues:**
- Touch non funziona ‚Üí Controllare event listeners e preventDefault
- Canvas non si ridimensiona ‚Üí Verificare resize handler
- Performance scadente ‚Üí Ottimizzare rendering loop
- Livelli non caricano ‚Üí Controllare GameManager.loadLevel()

---

## üöÄ ENFORCEMENT

**Queste regole sono OBBLIGATORIE e NON NEGOZIABILI.**

Ogni AI assistant che lavora su questo progetto DEVE:
1. Leggere e comprendere completamente queste regole
2. Seguire ogni regola senza eccezioni
3. Verificare compliance prima di ogni suggerimento
4. Migliorare il sistema esistente, non sostituirlo
5. Mantenere l'architettura consolidata
6. Ottimizzare per dispositivi mobili
7. Considerare performance e UX

**Il mancato rispetto di queste regole risulter√† in codice di qualit√† inferiore e introdurr√† regressioni nel progetto.** 